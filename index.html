<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <title>{{SITE_TITLE}}</title>

    <!-- Essential SEO Tags -->
    <meta name="description" content="{{SITE_DESCRIPTION}}">
    <meta name="keywords" content="{{SITE_KEYWORDS}}">
    <link rel="canonical" href="https://store.colorhutbd.xyz/" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{SITE_URL}}">
    <meta property="og:title" content="{{SITE_TITLE}}">
    <meta property="og:description" content="{{SITE_DESCRIPTION}}">
    <meta property="og:image" content="{{SITE_IMAGE}}">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{SITE_URL}}">
    <meta property="twitter:title" content="{{SITE_TITLE}}">
    <meta property="twitter:description" content="{{SITE_DESCRIPTION}}">
    <meta property="twitter:image" content="{{SITE_IMAGE}}">

    <!-- Geo Tags for Local SEO -->
    <meta name="geo.region" content="BD" />
    <meta name="geo.placename" content="Dhaka" />
    <meta name="geo.position" content="23.8103;90.4125" />
    <meta name="ICBM" content="23.8103, 90.4125" />

    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Aggressive Indexing Directives -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="bingbot" content="index, follow">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet" media="print" onload="this.media='all'">

    <!-- SEO: JSON-LD Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Color Hut Studio",
      "url": "https://store.colorhutbd.xyz",
      "logo": "/logo.png",
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+8801919760626",
        "contactType": "customer service"
      },
      "sameAs": [
        "https://www.facebook.com/colorhut",
        "https://www.instagram.com/colorhut"
      ]
    }
    </script>

    <style>
        ::-webkit-scrollbar {
            display: none;
        }

        html {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        :root {
            --primary: #f97316;
            --primary-dark: #ea580c;
            --accent: #4f46e5;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        img,
        video {
            -webkit-user-drag: none;
            user-select: none;
            pointer-events: none;
            /* Block extension hover detectors */
        }

        /* Premium Watermark System */
        .watermark-overlay {
            position: absolute;
            inset: 0;
            z-index: 10;
            opacity: 1;
            pointer-events: auto;
            /* Catch extension clicks and inspector */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dominant-baseline='middle' fill='white' fill-opacity='0.15' stroke='black' stroke-opacity='0.05' stroke-width='0.5' font-family='Arial, sans-serif' font-weight='bold' font-size='12' transform='rotate(-45, 90, 90)'%3ECOLOR HUT%3C/text%3E%3C/svg%3E");
            background-repeat: repeat;
        }

        .watermark-central {
            display: none;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }

        /* Clean Product Sheet System */
        #productSheetOverlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s ease;
        }

        #productSheetOverlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        #productSheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            z-index: 101;
            height: 85vh;
            border-radius: 2.5rem 2.5rem 0 0;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.32, 0.72, 0, 1);
            overflow-y: auto;
            box-shadow: 0 -20px 50px -12px rgba(0, 0, 0, 0.15);
        }

        #productSheet.active {
            transform: translateY(0);
        }

        @media (min-width: 1024px) {
            #productSheet {
                left: auto;
                top: 0;
                bottom: 0;
                width: 33vw;
                min-width: 480px;
                height: 100vh;
                border-radius: 0;
                transform: translateX(100%);
                padding-top: 2rem;
            }

            #productSheet.active {
                transform: translateX(0);
                transform: translateY(0);
            }
        }

        .sheet-close-btn {
            position: sticky;
            top: 1.5rem;
            right: 1.5rem;
            float: right;
            z-index: 102;
        }

        .sheet-markdown-content h1,
        .sheet-markdown-content h2,
        .sheet-markdown-content h3 {
            font-weight: 800;
            color: #0f172a;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }

        .sheet-markdown-content h1 {
            font-size: 1.5em;
        }

        .sheet-markdown-content h2 {
            font-size: 1.3em;
        }

        .sheet-markdown-content h3 {
            font-size: 1.1em;
        }

        .sheet-markdown-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .sheet-markdown-content ul {
            list-style: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .sheet-markdown-content li {
            margin-bottom: 0.5rem;
        }

        .sheet-markdown-content strong {
            font-weight: 800;
            color: #0f172a;
        }

        body.sheet-open {
            overflow: hidden;
        }

        .product-card {
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .shimmer-sweep {
            position: relative;
            overflow: hidden;
            background: #f1f5f9;
        }

        .shimmer-sweep::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0.4) 50%,
                    rgba(255, 255, 255, 0) 100%);
            transform: translateX(-100%);
            animation: shimmer-sweep-anim 1.5s infinite;
        }

        .shimmer-sweep.loaded::after {
            display: none;
        }

        @keyframes shimmer-sweep-anim {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .category-btn {
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .category-btn:hover {
            background: white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
            border-color: rgba(249, 115, 22, 0.2);
        }

        .category-btn.active {
            background: white;
            border-color: #f97316;
            box-shadow: 0 15px 30px -10px rgba(249, 115, 22, 0.2);
            color: #f97316;
        }

        .category-btn .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: all 0.3s ease;
        }

        .category-btn.active .dot {
            background: #f97316;
            box-shadow: 0 0 10px #f97316;
            transform: scale(1.2);
        }

        .nav-item-dropdown {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: white;
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 1.5rem;
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
            min-width: 220px;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 100;
        }

        .nav-item-dropdown::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 0;
            right: 0;
            height: 10px;
        }

        .nav-item-wrapper:hover .nav-item-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .dropdown-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            color: #64748b;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .dropdown-link:hover {
            background: #fff7ed;
            color: #f97316;
            padding-left: 1.25rem;
        }

        .view-more-btn {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            box-shadow: 0 10px 20px -5px rgba(249, 115, 22, 0.3);
        }

        .section-separator {
            background: linear-gradient(to right, #cbd5e1, transparent);
            height: 1px;
            flex-grow: 1;
        }

        .product-image-container {
            aspect-ratio: 1/1;
            width: 100%;
        }

        .contact-menu-item {
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
        }

        .help-popup {
            transform: scale(0.8) translateY(10px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            transform-origin: bottom right;
            pointer-events: none;
        }

        .help-popup.show {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        .contact-menu-open .contact-menu-item {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .contact-btn-icon {
            transition: all 0.3s ease;
        }

        /* Sheet image gallery enhancements */
        .sheet-thumb-indicator {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sheet-thumb-indicator.bg-orange-500 {
            transform: scale(1.2);
            box-shadow: 0 0 8px rgba(249, 115, 22, 0.4);
        }

        .sheet-thumb-checkmark {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .sheet-thumb-btn.active {
            border-color: #f97316;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.15);
        }

        .sheet-thumb-btn.active .sheet-thumb-overlay {
            opacity: 100;
            background-color: rgba(249, 115, 22, 0.2);
        }

        .sheet-thumb-btn:focus-visible {
            outline: 2px solid #f97316;
            outline-offset: 2px;
        }
    </style>
</head>

<body class="text-slate-900 selection:bg-orange-100 selection:text-orange-900">

    <header class="sticky top-0 z-50 shadow-sm">
        <!-- Top Header Bar -->
        <div class="bg-[#FF6B00] text-white py-2 px-4 md:px-12 text-[11px] md:text-xs">
            <div class="max-w-[1600px] mx-auto flex justify-between items-center">
                <div class="flex items-center gap-4 md:gap-8">
                    <div class="flex items-center gap-2">
                        <svg class="w-3 h-3 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                                stroke-width="2" />
                        </svg>
                        <span>+8801919760626</span>
                    </div>
                    <div class="flex items-center gap-3 md:gap-4">
                        <a href="#" class="hover:opacity-80 transition-opacity">
                            <svg class="w-3 h-3 md:w-4 md:h-4 fill-current" viewBox="0 0 24 24">
                                <path
                                    d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.791-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="flex items-center gap-4 md:gap-6">
                    <div class="flex items-center gap-1 cursor-pointer hover:opacity-80 transition-opacity">
                        <span>English</span>
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="flex items-center gap-1 cursor-pointer hover:opacity-80 transition-opacity">
                        <span>USD</span>
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Navigation Bar -->
        <nav class="bg-white border-b border-gray-100">
            <div
                class="max-w-[1600px] mx-auto px-4 md:px-12 py-3 md:py-5 flex flex-col md:flex-row items-center justify-between gap-4 md:gap-8">
                <!-- Logo Section -->
                <div class="w-full md:w-auto flex items-center justify-between">
                    <a href="/" class="flex items-center group">
                        <h1 class="sr-only">Color Hut Studio Premium Corporate Gifts</h1>
                        <img src="/logo.png" alt="Color Hut Studio | #1 Premium Corporate Gifts & Branding Bangladesh"
                            class="w-auto h-8 md:h-12 object-contain group-hover:scale-105 transition-all duration-500"
                            width="150" height="48" fetchpriority="high">
                    </a>

                    <!-- Mobile Icons -->
                    <div class="flex md:hidden items-center gap-4 text-gray-700">
                        <button class="hover:text-[#FF6B00] transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                                    stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                        <div class="relative">
                            <button class="hover:text-[#FF6B00] transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <span
                                    class="absolute -top-1.5 -right-1.5 bg-[#FF6B00] text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-bold">0</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Search Section -->
                <div class="w-full md:flex-1 max-w-2xl relative order-3 md:order-2">
                    <div class="relative w-full group">
                        <input type="text" id="searchInput" placeholder="Search Products..."
                            class="w-full h-11 md:h-14 pl-6 md:pl-8 pr-16 md:pr-20 rounded-full bg-gray-50 border border-gray-200 focus:bg-white focus:border-[#FF6B00] focus:ring-4 focus:ring-orange-500/5 transition-all outline-none text-sm md:text-base font-medium">
                        <button
                            class="absolute right-1.5 top-1.5 bottom-1.5 w-8 h-8 md:w-11 md:h-11 bg-[#FF6B00] rounded-full flex items-center justify-center text-white hover:bg-orange-600 transition-all hover:scale-105 active:scale-95 shadow-lg shadow-orange-500/20">
                            <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="3"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- User Icons Desktop -->
                <div class="hidden md:flex items-center gap-6 text-gray-600 order-2 md:order-3">
                    <a href="/admin" class="group flex items-center gap-2 hover:text-[#FF6B00] transition-colors">
                        <div
                            class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center group-hover:bg-orange-50 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                                    stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </div>
                    </a>
                    <div class="relative group">
                        <a href="#" class="flex items-center gap-2 hover:text-[#FF6B00] transition-colors">
                            <div
                                class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center group-hover:bg-orange-50 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                            <span
                                class="absolute -top-1 -right-1 bg-[#FF6B00] text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold border-2 border-white shadow-sm">0</span>
                        </a>
                    </div>
                    <div class="relative group">
                        <a href="#" class="flex items-center gap-2 hover:text-[#FF6B00] transition-colors">
                            <div
                                class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center group-hover:bg-orange-50 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                            <span
                                class="absolute -top-1 -right-1 bg-[#FF6B00] text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold border-2 border-white shadow-sm">0</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Category Navigation Bar -->
            <div class="bg-[#FF6B00] text-white md:block hidden relative z-30">
                <div class="max-w-[1600px] mx-auto flex items-center h-12 px-12 gap-1 justify-center whitespace-nowrap"
                    id="desktopCategoryNav">
                    <!-- Populated by JS -->
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-[1600px] mx-auto px-4 md:px-10 py-6 md:py-12 flex flex-col lg:flex-row gap-8 md:gap-12">
        <aside id="sidebar-container" class="w-full lg:w-72 flex-shrink-0">
            <div
                class="bg-slate-50/50 border border-slate-200/50 p-2 rounded-3xl lg:rounded-[2.5rem] lg:sticky lg:top-32">
                <p
                    class="hidden lg:block text-[10px] font-black uppercase tracking-[0.4em] text-slate-400 mb-4 pt-6 px-8">
                    Curated Categories</p>
                <nav class="flex lg:flex-col gap-2 overflow-x-auto lg:overflow-y-auto lg:max-h-[calc(100vh-250px)] pb-2 lg:pb-6 scrollbar-hide px-2 md:px-3"
                    id="categoryNav">
                </nav>
            </div>
        </aside>

        <section class="flex-1">
            <div id="grid-container" class="space-y-10 md:space-y-16">
            </div>

            <div id="empty-state" class="hidden flex-col items-center justify-center py-20 text-center">
                <div
                    class="w-16 h-16 md:w-20 md:h-20 bg-slate-100 rounded-2xl md:rounded-3xl flex items-center justify-center mb-6">
                    <svg class="w-8 h-8 md:w-10 md:h-10 text-slate-300" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <h3 class="text-lg md:text-xl font-bold text-slate-900 mb-2">No matching products</h3>
                <p class="text-sm text-slate-500 px-4">Try adjusting your search or filters to find what you're looking
                    for.</p>
            </div>
        </section>
    </main>

    <div class="fixed bottom-6 right-6 z-[100] flex flex-col items-end gap-4">
        <div id="contactMenu" class="flex flex-col items-end gap-3 mb-2">
            <a href="https://wa.me/8801919760626" target="_blank"
                class="contact-menu-item flex items-center gap-3 bg-white pl-4 pr-1 py-1 rounded-full shadow-lg">
                <span class="font-bold text-slate-700 text-xs md:text-sm">WhatsApp</span>
                <div class="w-10 h-10 rounded-full bg-[#25D366] flex items-center justify-center text-white">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
                    </svg>
                </div>
            </a>
            <a href="tel:+8801919760626"
                class="contact-menu-item flex items-center gap-3 bg-white pl-4 pr-1 py-1 rounded-full shadow-lg">
                <span class="font-bold text-slate-700 text-xs md:text-sm">Call Us</span>
                <div class="w-10 h-10 rounded-full bg-[#f97316] flex items-center justify-center text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                </div>
            </a>
        </div>

        <div id="needHelpPopup"
            class="help-popup absolute bottom-20 right-0 bg-white px-5 py-3 rounded-2xl shadow-xl flex items-center gap-3 w-max">
            <span class="text-sm font-bold text-slate-700">Need Help? ðŸ‘‹</span>
        </div>
    </div>

    <!-- Product Details Sheet -->
    <div id="productSheetOverlay" onclick="closeProductSheet()"></div>
    <div id="productSheet" class="scrollbar-hide">
        <button onclick="closeProductSheet()"
            class="sheet-close-btn w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-800 hover:bg-slate-200 transition-all shadow-sm">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M6 18L18 6M6 6l12 12" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </button>

        <div id="sheetLoading" class="hidden flex flex-col items-center justify-center h-full space-y-4">
            <div class="w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-sm font-bold text-slate-400 uppercase tracking-widest">Designing Identity...</p>
        </div>

        <div id="sheetContent" class="opacity-0 transition-opacity duration-500 p-6 md:p-10">
            <!-- Dynamically populated -->
        </div>
    </div>

    <!-- Quote Funnel Sheet -->
    <div id="quoteSheetOverlay" onclick="closeQuoteSheet()"
        class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[110] hidden transition-opacity duration-500 opacity-0">
    </div>
    <div id="quoteSheet"
        class="fixed bottom-0 left-0 right-0 bg-white z-[120] rounded-t-[3rem] shadow-2xl transition-all duration-500 translate-y-full max-h-[90vh] overflow-y-auto scrollbar-hide">
        <div class="p-8 md:p-12 max-w-2xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-slate-900">Get a Quote</h2>
                <button onclick="closeQuoteSheet()"
                    class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 hover:text-orange-500 transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M6 18L18 6M6 6l12 12" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <form id="quoteForm" onsubmit="submitQuote(event)" class="space-y-6">
                <input type="hidden" id="quoteProduct" name="product">

                <div class="space-y-5">
                    <!-- Name -->
                    <div>
                        <label class="block text-base font-semibold text-slate-900 mb-2">Name</label>
                        <input type="text" name="name" placeholder="Your full name" required
                            class="w-full bg-white border border-slate-200 rounded-xl py-3.5 px-5 outline-none focus:border-slate-400 font-medium text-slate-700 transition-all placeholder:text-slate-400">
                    </div>

                    <!-- Business Type -->
                    <div>
                        <label class="block text-base font-semibold text-slate-900 mb-2">Business Type</label>
                        <div class="relative">
                            <select name="business_type" id="business_type_select" required
                                onchange="updateAddressLabel(this.value)"
                                class="w-full bg-white border border-slate-200 rounded-xl py-3.5 px-5 outline-none focus:border-slate-400 font-medium text-slate-700 appearance-none transition-all cursor-pointer">
                                <option value="" disabled selected>Select Business Type</option>
                                <option value="Restaurant">Restaurant</option>
                                <option value="Parlor">Parlor</option>
                                <option value="Others">Others</option>
                            </select>
                            <div class="absolute right-5 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Address -->
                    <div>
                        <label id="addressLabel" class="block text-base font-semibold text-slate-900 mb-2">Business
                            Address</label>
                        <input type="text" id="addressInput" name="address" placeholder="Store or Office Location"
                            required
                            class="w-full bg-white border border-slate-200 rounded-xl py-3.5 px-5 outline-none focus:border-slate-400 font-medium text-slate-700 transition-all placeholder:text-slate-400">
                    </div>

                    <!-- Contact -->
                    <div>
                        <label class="block text-base font-semibold text-slate-900 mb-2">Contact Number</label>
                        <input type="tel" name="phone" placeholder="Phone number" required
                            class="w-full bg-white border border-slate-200 rounded-xl py-3.5 px-5 outline-none focus:border-slate-400 font-medium text-slate-700 transition-all placeholder:text-slate-400">
                    </div>

                    <!-- Service -->
                    <div>
                        <label class="block text-base font-semibold text-slate-900 mb-2">Service</label>
                        <div class="relative">
                            <select name="service" required
                                class="w-full bg-white border border-slate-200 rounded-xl py-3.5 px-5 outline-none focus:border-slate-400 font-medium text-slate-700 appearance-none transition-all cursor-pointer">
                                <option value="" disabled selected>Select a service</option>
                                <option value="Brand Identity">Brand Identity</option>
                                <option value="UI/UX Design">UI/UX Design</option>
                                <option value="Web Development">Web Development</option>
                                <option value="Custom Artwork">Custom Artwork</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="absolute right-5 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pt-2">
                    <button type="submit"
                        class="w-full bg-black text-white py-4 rounded-xl font-bold hover:bg-slate-900 transition-all active:scale-[0.98] text-lg">
                        Submit
                    </button>
                </div>
            </form>
            </form>
        </div>
    </div>

    <script>
        let items = [];
        let categories = [];
        let currentCategory = 'All';
        let currentMainCategory = 'All';
        let currentSheetProduct = null;
        let visibleCounts = {};

        // Shared Hosting Optimization: Thumbnail detection
        function getThumb(src) {
            if (!src || src.startsWith('blob:') || src.startsWith('data:')) return src;
            if (src.includes('/opt-') && !src.includes('/thumb-')) {
                const parts = src.split('/');
                const filename = parts.pop();
                return parts.join('/') + '/thumb-' + filename;
            }
            return src;
        }

        const intersectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target;
                    const src = el.getAttribute('data-pending-src');
                    if (src) {
                        el.removeAttribute('data-pending-src');
                        const prio = el.getAttribute('data-pending-priority') || 'auto';
                        el.removeAttribute('data-pending-priority');
                        intersectionObserver.unobserve(el);
                        secureMedia(el, src, prio);
                    }
                }
            });
        }, { rootMargin: '600px' });

        async function secureMedia(el, src, priority = 'auto') {
            if (!src || src.startsWith('blob:') || src.startsWith('data:')) return;
            try {
                const response = await fetch(src, { priority });
                const blob = await response.blob();

                if (el.tagName === 'IMG') {
                    const bitmap = await createImageBitmap(blob);
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d', { alpha: false });

                    const maxDim = 1200;
                    let scale = 1;
                    if (bitmap.width > maxDim || bitmap.height > maxDim) {
                        scale = maxDim / Math.max(bitmap.width, bitmap.height);
                    }

                    canvas.width = bitmap.width * scale;
                    canvas.height = bitmap.height * scale;

                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    ctx.drawImage(bitmap, 0, 0, canvas.width, canvas.height);
                    bitmap.close();

                    canvas.id = el.id;
                    canvas.className = el.className;
                    canvas.alt = el.alt;
                    canvas.style.cssText = el.style.cssText;
                    canvas.style.opacity = '0';
                    canvas.style.transition = 'opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1)';

                    const style = window.getComputedStyle(el);
                    canvas.style.width = (style.width && style.width !== '0px' && style.width !== 'auto' && !el.className.includes('w-full')) ? style.width : '100%';
                    canvas.style.height = (style.height && style.height !== '0px' && style.height !== 'auto' && !el.className.includes('h-full')) ? style.height : '100%';
                    canvas.style.objectFit = style.objectFit || 'contain';

                    canvas.setAttribute('data-ghost', 'true');
                    if (el.parentNode) {
                        el.parentNode.classList.add('loaded');
                        el.parentNode.replaceChild(canvas, el);
                    }

                    requestAnimationFrame(() => {
                        canvas.style.opacity = '1';
                    });
                } else if (el.tagName === 'VIDEO') {
                    const blobUrl = URL.createObjectURL(blob);
                    el.src = blobUrl;
                    el.setAttribute('controlsList', 'nodownload');
                    el.oncontextmenu = e => e.preventDefault();
                }
            } catch (e) {
                console.error('SECURE MEDIA ERROR', e);
            }
        }

        // Quote Sheet Logic replaced by assets/quote-funnel.js


        const mediaObserver = new MutationObserver((mutations) => {
            mutations.forEach(mutation => {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach(node => {
                        if (node.nodeType === 1) {
                            const targets = node.querySelectorAll('img[data-src]:not([data-ghost]), video[data-src]');
                            if (node.hasAttribute('data-src')) processNode(node);
                            targets.forEach(processNode);
                        }
                    });
                } else if (mutation.type === 'attributes' && mutation.attributeName === 'data-src') {
                    processNode(mutation.target);
                }
            });
        });

        function processNode(el) {
            const s = el.getAttribute('data-src');
            if (s && !el.hasAttribute('data-ghost')) {
                const isEager = el.getAttribute('loading') === 'eager';
                const priority = el.getAttribute('fetchpriority') || 'auto';

                el.removeAttribute('data-src');

                if (isEager) {
                    // Bypass IntersectionObserver for critical above-the-fold content
                    secureMedia(el, s, priority);
                } else {
                    el.setAttribute('data-pending-src', s);
                    el.setAttribute('data-pending-priority', priority);
                    intersectionObserver.observe(el);
                }
            }
        }

        mediaObserver.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['data-src']
        });

        async function fetchCategories() {
            try {
                const response = await fetch('/api/public/categories');
                const data = await response.json();
                if (Array.isArray(data)) {
                    categories = data;
                    renderCategoryNav();
                } else {
                    console.error('Expected categories array, but got:', data);
                    categories = [];
                }
            } catch (error) { console.error('Error fetching categories:', error); }
        }

        function enableDragToScroll(container) {
            if (!container) return;
            let isDown = false;
            let startX;
            let scrollLeft;
            let startY;
            let scrollTop;

            container.addEventListener('mousedown', (e) => {
                isDown = true;
                startX = e.pageX - container.offsetLeft;
                startY = e.pageY - container.offsetTop;
                scrollLeft = container.scrollLeft;
                scrollTop = container.scrollTop;
                container.style.cursor = 'grabbing';
            });

            container.addEventListener('mouseleave', () => {
                isDown = false;
                container.style.cursor = 'grab';
            });

            container.addEventListener('mouseup', () => {
                isDown = false;
                container.style.cursor = 'grab';
            });

            container.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                const x = e.pageX - container.offsetLeft;
                const y = e.pageY - container.offsetTop;
                const walkX = (x - startX) * 2;
                const walkY = (y - startY) * 2;
                if (Math.abs(walkX) < 5 && Math.abs(walkY) < 5) return;
                e.preventDefault();
                container.scrollLeft = scrollLeft - walkX;
                container.scrollTop = scrollTop - walkY;
            });
            container.style.cursor = 'grab';
        }

        async function fetchProducts() {
            try {
                const response = await fetch('/api/public/products');
                const products = await response.json();
                if (!Array.isArray(products)) {
                    console.error('Expected products array, but got:', products);
                    items = [];
                    return;
                }
                items = products.map(p => {
                    let images = [];
                    try { images = p.image ? (p.image.startsWith('[') ? JSON.parse(p.image) : [p.image]) : []; } catch (e) { images = [p.image]; }
                    return {
                        id: p.id,
                        title: p.name,
                        slug: p.slug,
                        cat: p.category_name || 'Uncategorized',
                        rating: parseFloat(p.rating) || 0,
                        img: images[0] || 'https://via.placeholder.com/400',
                        price: p.price
                    };
                });
                updateCounts();
                applyFilters();
            } catch (error) { console.error('Error:', error); }
        }

        function renderCategoryNav() {
            const desktopCategoryNav = document.getElementById('desktopCategoryNav');

            let topLinksHTML = createTopCatLink('All', 'All Products');
            const mainCategories = categories.filter(c => !c.parent_ids);
            mainCategories.forEach(cat => {
                topLinksHTML += createTopCatLink(cat.name, cat.name);
            });

            // Add Blog Link
            topLinksHTML += `
                <div class="nav-item-wrapper relative flex items-center h-full ml-auto">
                    <a href="/blog" 
                       class="flex items-center gap-2 px-6 py-2 rounded-full border-2 border-white/30 font-black text-[10px] uppercase tracking-widest transition-all hover:bg-white hover:text-orange-600">
                        <span>Perspective Blog</span>
                    </a>
                </div>`;

            if (desktopCategoryNav) {
                desktopCategoryNav.innerHTML = topLinksHTML;
                enableDragToScroll(desktopCategoryNav);
            }
            renderSidebar();
        }

        function renderSidebar() {
            const sidebar = document.getElementById('sidebar-container');
            const categoryNav = document.getElementById('categoryNav');

            if (currentMainCategory === 'All') {
                if (sidebar) sidebar.classList.add('hidden');
            } else {
                if (sidebar) sidebar.classList.remove('hidden');
            }

            if (!categoryNav) return;

            let buttonsHTML = '';
            if (currentMainCategory === 'All') {
                buttonsHTML = createCatBtn('All', 'All Collections');
                const mainCategories = categories.filter(c => !c.parent_ids);
                mainCategories.forEach(cat => {
                    buttonsHTML += createCatBtn(cat.name, cat.name);
                });
            } else {
                const mainCat = categories.find(c => c.name === currentMainCategory);
                if (mainCat) {
                    buttonsHTML = createCatBtn(mainCat.name, 'All ' + mainCat.name);
                    const subCats = categories.filter(c => {
                        const pIds = c.parent_ids ? c.parent_ids.split(',').map(Number) : [];
                        return pIds.includes(mainCat.id);
                    });
                    subCats.forEach(sc => {
                        buttonsHTML += createCatBtn(sc.name, sc.name);
                    });
                }
            }
            categoryNav.innerHTML = buttonsHTML;
            updateCounts();
            enableDragToScroll(categoryNav);
        }

        function createTopCatLink(id, name) {
            const cat = categories.find(c => c.name === id);
            const slug = cat ? cat.slug : 'all';
            const isActive = currentMainCategory === id;
            const activeClass = isActive ? 'bg-white/20' : 'hover:bg-white/10';

            let dropdownHtml = '';
            if (id !== 'All' && cat) {
                const subCats = categories.filter(c => {
                    const pIds = c.parent_ids ? c.parent_ids.split(',').map(Number) : [];
                    return pIds.includes(cat.id);
                });

                if (subCats.length > 0) {
                    dropdownHtml = `
                        <div class="nav-item-dropdown">
                            ${subCats.map(sc => `
                                <a href="/${sc.slug}" onclick="handleNavClick(event, '${sc.name}')" class="dropdown-link">
                                    ${sc.icon ? `<img src="${getThumb(sc.icon)}" class="w-5 h-5 object-cover rounded">` : `<span class="w-2 h-2 rounded-full bg-slate-200"></span>`}
                                    <span>${sc.name}</span>
                                </a>
                            `).join('')}
                        </div>
                    `;
                }
            }

            return `
                <div class="nav-item-wrapper relative flex items-center h-full">
                    <a href="/${slug === 'all' ? '' : slug}" onclick="handleNavClick(event, '${id}')" 
                       class="flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-xs md:text-sm transition-all ${activeClass}">
                        <span>${name}</span>
                        ${dropdownHtml ? '<svg class="w-3 h-3 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>' : ''}
                    </a>
                    ${dropdownHtml}
                </div>`;
        }

        function createCatBtn(id, name) {
            const cat = categories.find(c => c.name === id);
            const activeClass = currentCategory === id ? 'active' : 'text-slate-500 hover:bg-white/80';

            let iconHtml = '<span class="dot flex-shrink-0"></span>';
            if (cat && cat.icon) {
                iconHtml = `<div class="w-6 h-6 flex-shrink-0 flex items-center justify-center overflow-hidden">
                                <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${getThumb(cat.icon)}" class="w-full h-full object-contain">
                            </div>`;
            } else if (id === 'All') {
                iconHtml = `<svg class="w-5 h-5 text-slate-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
            }

            return `
                <button onclick="handleNavClick(event, '${id}')" class="category-btn ${activeClass} flex-shrink-0 flex items-center justify-between px-5 lg:px-6 py-3 lg:py-4 rounded-2xl lg:rounded-[1.5rem]">
                    <div class="flex items-center gap-3">
                        ${iconHtml}
                        <span class="text-xs md:text-sm font-bold">${name}</span>
                    </div>
                    <span class="ml-4 text-[10px] font-bold opacity-40" id="count-${id}">0</span>
                </button>`;
        }

        function getProductHTML(item, index = 10) {
            const stars = Array.from({ length: 5 }, (_, i) =>
                `<svg class="w-2.5 h-2.5 md:w-3 md:h-3 ${i < Math.round(item.rating) ? 'text-orange-400 fill-current' : 'text-slate-200 fill-current'}" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`
            ).join('');

            const isPriority = index < 4;
            const loadingAttr = isPriority ? 'eager' : 'lazy';
            const priorityAttr = isPriority ? 'fetchpriority="high"' : '';

            return `
                <a href="/p/${item.slug}" onclick="openProductSheet(event, '${item.slug}')" class="product-card group bg-white rounded-xl block h-full overflow-hidden">
                    <div class="product-image-container shimmer-sweep overflow-hidden relative">
                        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${getThumb(item.img)}" class="w-full h-full object-contain group-hover:scale-110 transition-transform duration-1000" 
                             alt="Premium ${item.title} - ${item.cat} | Color Hut Studio Bangladesh" 
                             ${priorityAttr} loading="${loadingAttr}" width="400" height="400">
                        <!-- Inspector Shield -->
                        <div class="absolute inset-0 z-10 pointer-events-auto"></div>
                    </div>
                    <div class="p-3 md:p-5">
                        <div class="flex items-center mb-1 md:mb-2">${stars}</div>
                        <h3 class="text-xs md:text-base font-bold group-hover:text-orange-600 transition-colors line-clamp-2">${item.title}</h3>
                    </div>
                </a>`;
        }

        function renderSection(title, products, viewId) {
            const limit = visibleCounts[viewId] || 20;
            const displayed = products.slice(0, limit);
            const hasMore = products.length > limit;

            return `
                <div class="product-section">
                    <div class="flex items-center gap-3 md:gap-6 mb-4 md:mb-8">
                        <h2 class="text-lg md:text-2xl font-black text-slate-900 whitespace-nowrap">${title}</h2>
                        <div class="section-separator"></div>
                        <span class="text-[10px] md:text-sm font-bold text-slate-400 uppercase tracking-wider">${products.length} Items</span>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3 md:gap-6">
                        ${displayed.map((p, idx) => getProductHTML(p, idx)).join('')}
                    </div>
                    ${hasMore ? `
                        <div class="mt-8 md:mt-12 flex justify-center">
                            <button onclick="viewMore('${viewId}')" class="view-more-btn px-8 md:px-10 py-3 md:py-4 rounded-xl md:rounded-2xl text-white font-bold text-xs md:text-sm flex items-center gap-3">
                                View More Collections
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                        </div>
                    ` : ''}
                </div>`;
        }

        function render(products) {
            const container = document.getElementById('grid-container');
            const emptyState = document.getElementById('empty-state');

            if (products.length === 0) {
                container.innerHTML = '';
                emptyState.classList.replace('hidden', 'flex');
                return;
            }

            emptyState.classList.replace('flex', 'hidden');

            if (currentCategory === 'All') {
                container.innerHTML = renderSection('All Collections', products, 'All');
            } else {
                container.innerHTML = renderSection(currentCategory, products, currentCategory);
            }
        }

        function viewMore(viewId) {
            visibleCounts[viewId] = (visibleCounts[viewId] || 20) + 20;
            applyFilters();
        }

        // Sheet image gallery functions
        function changeSheetImage(index) {
            if (!currentSheetProduct) return;

            const images = getProductImages(currentSheetProduct);
            if (images && images[index]) {
                const container = document.getElementById('sheet-main-img-container');
                if (container) {
                    // We swap the whole content to let the mutation observer re-secure the new image
                    container.innerHTML = `
                        <img id="sheet-main-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${images[index]}" class="w-full h-full object-contain" alt="${currentSheetProduct.name}">
                        <div class="watermark-overlay"></div>
                    `;
                }

                // Update indicators
                updateImageIndicators(index);
            }
        }

        function updateImageIndicators(activeIndex) {
            // Update thumbnail buttons
            const thumbBtns = document.querySelectorAll('.sheet-thumb-btn');
            thumbBtns.forEach((btn, idx) => {
                if (idx === activeIndex) {
                    btn.classList.add('active');
                    btn.querySelector('.sheet-thumb-checkmark').classList.remove('opacity-0', 'scale-75');
                    btn.querySelector('.sheet-thumb-checkmark').classList.add('opacity-100', 'scale-100');
                } else {
                    btn.classList.remove('active');
                    btn.querySelector('.sheet-thumb-checkmark').classList.add('opacity-0', 'scale-75');
                    btn.querySelector('.sheet-thumb-checkmark').classList.remove('opacity-100', 'scale-100');
                }
            });
        }

        function getProductImages(product) {
            try {
                return product.image ?
                    (product.image.startsWith('[') ? JSON.parse(product.image) : [product.image]) :
                    [];
            } catch (e) {
                return [product.image];
            }
        }

        async function openProductSheet(event, slug) {
            if (event) event.preventDefault();

            const overlay = document.getElementById('productSheetOverlay');
            const sheet = document.getElementById('productSheet');
            const content = document.getElementById('sheetContent');
            const loader = document.getElementById('sheetLoading');

            document.body.classList.add('sheet-open');
            overlay.classList.add('active');
            sheet.classList.add('active');

            content.classList.add('opacity-0');
            loader.classList.remove('hidden');

            try {
                const prodPromise = fetch(`/api/public/products/slug/${slug}`).then(r => r.json());
                const [product] = await Promise.all([prodPromise]);

                const relatedResponse = await fetch(`/api/public/related/${product.category_id}?exclude=${product.id}`);
                const related = await relatedResponse.json();

                // Store current product
                currentSheetProduct = product;

                window.history.pushState({ product: slug }, '', `/p/${slug}`);

                renderSheetContent(product, related);

                setTimeout(() => {
                    loader.classList.add('hidden');
                    content.classList.remove('opacity-0');
                }, 300);

            } catch (err) {
                console.error(err);
                window.location.href = `/p/${slug}`;
            }
        }

        function closeProductSheet() {
            const overlay = document.getElementById('productSheetOverlay');
            const sheet = document.getElementById('productSheet');

            document.body.classList.remove('sheet-open');
            overlay.classList.remove('active');
            sheet.classList.remove('active');
            currentSheetProduct = null;

            if (window.location.pathname.includes('/p/')) {
                window.history.pushState({}, '', '/');
            }
        }

        function renderSheetContent(p, related) {
            const content = document.getElementById('sheetContent');
            const images = getProductImages(p);
            const rating = parseFloat(p.rating) || 0;
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const starHTML = Array.from({ length: 5 }, (_, i) => {
                let fillInfo = 'text-slate-200 fill-current';
                if (i < fullStars) fillInfo = 'text-orange-400 fill-current';
                else if (i === fullStars && hasHalfStar) fillInfo = 'text-orange-400 fill-current';
                return `<svg class="w-5 h-5 ${fillInfo}" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`;
            }).join('');

            const relatedHTML = related.map(item => {
                let rImages = getProductImages(item);
                const rImg = rImages[0] || 'https://via.placeholder.com/400';
                return `
                    <a href="/p/${item.slug}" onclick="openProductSheet(event, '${item.slug}')" class="group flex-shrink-0 w-32">
                        <div class="aspect-square rounded-2xl overflow-hidden bg-slate-50 border border-slate-100 mb-2 shimmer-sweep">
                            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${getThumb(rImg)}" class="w-full h-full object-contain group-hover:scale-110 transition-transform duration-500" loading="lazy">
                        </div>
                        <h4 class="text-[10px] font-bold text-slate-900 line-clamp-1 group-hover:text-orange-600 transition-colors">${item.name}</h4>
                    </a>
                `;
            }).join('');

            // Thumbnail buttons with icons
            const thumbnailButtons = images.map((img, idx) => `
                <button onclick="changeSheetImage(${idx})" 
                        class="sheet-thumb-btn relative w-20 h-20 rounded-xl overflow-hidden bg-slate-50 border border-slate-100 flex-shrink-0 hover:border-orange-500 transition-all duration-300 group ${idx === 0 ? 'active' : ''} shimmer-sweep">
                    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${getThumb(img)}" class="w-full h-full object-contain">
                    
                    <!-- Active overlay -->
                    <div class="sheet-thumb-overlay absolute inset-0 bg-orange-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    <!-- Active state checkmark icon -->
                    <div class="sheet-thumb-checkmark absolute bottom-1 right-1 w-4 h-4 rounded-full bg-orange-500 flex items-center justify-center 
                               transition-all duration-300 ${idx === 0 ? 'opacity-100 scale-100' : 'opacity-0 scale-75'}">
                        <svg class="w-2.5 h-2.5 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </button>
            `).join('');

            content.innerHTML = `
                <div class="mb-10">
                    <span class="inline-block text-xs font-black uppercase tracking-[0.3em] text-orange-500 mb-4">${p.category_name}</span>
                    <h2 class="text-3xl md:text-4xl font-black tracking-tight text-slate-900 leading-tight mb-6">${p.name}</h2>
                    <div class="flex items-center gap-1 mb-8">
                        ${starHTML}
                        <span class="text-xs font-bold text-slate-400 ml-2">(${rating} / 5.0)</span>
                    </div>
                </div>

                <!-- Product Gallery with Icon Indicators -->
                <div class="space-y-4 mb-12">
                    <div id="sheet-main-img-container" class="rounded-[2rem] overflow-hidden bg-white shadow-2xl border border-slate-100 aspect-square relative shimmer-sweep">
                        <img id="sheet-main-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${images[0]}" class="w-full h-full object-contain" alt="${p.name}">
                        
                        <!-- Watermark Layer -->
                        <div class="watermark-overlay"></div>
                    </div>
                    
                    ${images.length > 1 ? `
                    <div class="sheet-gallery-scroll flex gap-3 overflow-x-auto pb-2 scrollbar-hide px-1">
                        ${thumbnailButtons}
                    </div>` : ''}
                </div>

                <div class="mb-12">
                    <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 mb-6 flex items-center gap-3">
                        <span class="w-6 h-0.5 bg-orange-500"></span>
                        Details & Meta
                    </h3>
                    <div class="sheet-markdown-content text-slate-500 text-base md:text-lg leading-relaxed font-medium">
                        ${parseMarkdown(p.description || 'Premium Branding & Design Identity Solution by Color Hut Studio.')}
                    </div>
                </div>

                <div class="flex flex-col md:flex-row gap-4 mb-12">
                    <button onclick="inquireWhatsApp('${p.slug}')" 
                            class="flex-1 bg-slate-950 text-white px-8 py-5 rounded-[2rem] text-base font-bold hover:bg-orange-600 transition-all shadow-2xl shadow-slate-300 active:scale-95 flex items-center justify-center gap-3">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                        </svg>
                        WhatsApp
                    </button>
                    <button onclick="openQuoteSheet('${p.name}')" 
                            class="flex-1 bg-white text-slate-900 border-2 border-slate-100 px-8 py-5 rounded-[2rem] text-base font-bold hover:border-orange-500 hover:text-orange-500 transition-all shadow-xl active:scale-95 flex items-center justify-center gap-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        Get a Quote
                    </button>
                </div>

                <!-- Related Products -->
                ${relatedHTML ? `
                <div class="mt-16 pt-12 border-t border-slate-100">
                    <h3 class="text-xs font-black uppercase tracking-widest text-slate-400 mb-8">Related Creations</h3>
                    <div class="sheet-related-scroll flex gap-4 overflow-x-auto pb-4 scrollbar-hide">
                        ${relatedHTML}
                    </div>
                </div>` : ''}
            `;

            // Enable drag-to-scroll for the galleries in the sheet
            setTimeout(() => {
                const sheetGallery = content.querySelector('.sheet-gallery-scroll');
                const sheetRelated = content.querySelector('.sheet-related-scroll');
                if (sheetGallery) enableDragToScroll(sheetGallery);
                if (sheetRelated) enableDragToScroll(sheetRelated);
            }, 50);
        }

        function parseMarkdown(text) {
            if (!text) return '';
            return text
                .replace(/### (.*)/g, '<h3 class="text-lg font-black mt-6 mb-3">$1</h3>')
                .replace(/## (.*)/g, '<h2 class="text-xl font-black mt-8 mb-4">$1</h2>')
                .replace(/# (.*)/g, '<h1 class="text-2xl font-black mt-10 mb-6">$1</h1>')
                .replace(/\*\*(.*)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*)\*/g, '<em>$1</em>')
                .replace(/^- (.*)/gm, '<li>$1</li>')
                .replace(/(<li>.*<\/li>)/gms, '<ul class="my-4">$1</ul>')
                .split('\n\n')
                .map(para => {
                    if (para.trim().startsWith('<')) return para;
                    return `<p>${para.replace(/\n/g, '<br>')}</p>`;
                }).join('');
        }

        function inquireWhatsApp(slug) {
            const phoneNumber = "8801919760626";
            const message = `Hello, I'm interested in this product: https://store.colorhutbd.xyz/p/${slug}`;
            window.open(`https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(message)}`, '_blank');
        }

        window.addEventListener('popstate', (e) => {
            if (document.getElementById('productSheet').classList.contains('active')) {
                closeProductSheet();
            }
        });

        function updateCounts() {
            const allCount = document.getElementById('count-All');
            if (allCount) allCount.innerText = items.length;
            categories.forEach(cat => {
                const el = document.getElementById(`count-${cat.name}`);
                if (el) el.innerText = items.filter(i => i.cat === cat.name).length;
            });
        }

        function handleNavClick(e, category) {
            if (e) e.preventDefault();
            filterProducts(category);

            const cat = categories.find(c => c.name === category);
            const newPath = cat ? `/${cat.slug}` : '/';
            window.history.pushState({ category }, '', newPath);
        }

        function filterProducts(category) {
            const isMain = categories.some(c => c.name === category && !c.parent_ids);
            if (isMain || category === 'All') {
                currentMainCategory = category;
            }
            currentCategory = category;

            if (category === 'All') {
                document.title = 'Color Hut Studio | Premium Digital Assets';
            } else {
                document.title = `${category} | Color Hut Studio`;
            }

            renderCategoryNav();
            applyFilters();
            if (window.innerWidth < 1024) window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function applyFilters() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            let filtered = items;

            if (currentCategory !== 'All') {
                const selectedCat = categories.find(c => c.name === currentCategory);
                if (selectedCat) {
                    const pIds = selectedCat.parent_ids ? selectedCat.parent_ids.split(',').map(Number) : [];
                    if (pIds.length === 0) {
                        // It is a main category, include all products in its subcategories
                        const subCatNames = categories.filter(c => {
                            const subPIds = c.parent_ids ? c.parent_ids.split(',').map(Number) : [];
                            return subPIds.includes(selectedCat.id);
                        }).map(c => c.name);
                        filtered = filtered.filter(i => i.cat === currentCategory || subCatNames.includes(i.cat));
                    } else {
                        filtered = filtered.filter(i => i.cat === currentCategory);
                    }
                }
            }

            if (query) {
                filtered = filtered.filter(i => i.title.toLowerCase().includes(query) || i.cat.toLowerCase().includes(query));
            }
            render(filtered);
        }

        function toggleContactMenu() {
            const menu = document.getElementById('contactMenu');
            const chatIcon = document.getElementById('chatIcon');
            const closeIcon = document.getElementById('closeIcon');
            menu.classList.toggle('contact-menu-open');

            if (menu.classList.contains('contact-menu-open')) {
                chatIcon.style.opacity = '0'; chatIcon.style.transform = 'scale(0)';
                closeIcon.style.opacity = '1'; closeIcon.style.transform = 'scale(1)';
                document.getElementById('needHelpPopup').classList.remove('show');
            } else {
                chatIcon.style.opacity = '1'; chatIcon.style.transform = 'scale(1)';
                closeIcon.style.opacity = '0'; closeIcon.style.transform = 'scale(0)';
            }
        }

        document.getElementById('searchInput').addEventListener('input', applyFilters);

        async function init() {
            await fetchCategories();
            await fetchProducts();

            const path = window.location.pathname.replace(/^\/|\/$/g, '');
            if (path && path !== 'index.html') {
                const catBySlug = categories.find(c => c.slug === path);
                if (catBySlug) {
                    filterProducts(catBySlug.name);
                }
            }

            const urlParams = new URLSearchParams(window.location.search);
            const search = urlParams.get('search');
            const cat = urlParams.get('cat');

            if (cat) {
                filterProducts(cat);
            }
            if (search) {
                document.getElementById('searchInput').value = search;
                applyFilters();
            }

            window.onpopstate = (e) => {
                const path = window.location.pathname.replace(/^\/|\/$/g, '');
                if (!path || path === 'index.html') {
                    filterProducts('All');
                } else {
                    const catBySlug = categories.find(c => c.slug === path);
                    if (catBySlug) filterProducts(catBySlug.name);
                }
            };
        }

        init();
    </script>

    <!-- SEO Content Section -->
    <section class="max-w-[1600px] mx-auto px-6 py-20 border-t border-slate-100">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
            <div>
                <h2 class="text-3xl font-black text-slate-900 mb-6 leading-tight">
                    The Leading <span class="text-orange-600">Graphic Design & Printing Studio</span> in Dhaka
                </h2>
                <p class="text-slate-600 leading-relaxed mb-6 font-medium">
                    Color Hut Studio is a premier graphic design and professional printing service based in Dhaka,
                    Bangladesh.
                    We specialize in creating vibrant visual materials, including custom membership cards, restaurant
                    loyalty cards,
                    and premium branding solutions. Our studio is dedicated to producing high-quality marketing
                    materials
                    and product labels that elevate local businesses with unique color expertise and professional
                    finishes.
                </p>
                <div class="space-y-4">
                    <div class="flex gap-4">
                        <div
                            class="w-10 h-10 rounded-full bg-orange-50 flex items-center justify-center flex-shrink-0 text-orange-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M5 13l4 4L19 7" stroke-width="3" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-900">Custom Membership & Loyalty Cards</h4>
                            <p class="text-sm text-slate-500">Professional design and printing of unique loyalty cards
                                for restaurants and businesses in Bangladesh.</p>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div
                            class="w-10 h-10 rounded-full bg-orange-50 flex items-center justify-center flex-shrink-0 text-orange-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M5 13l4 4L19 7" stroke-width="3" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-900">Expert Branding & Packaging</h4>
                            <p class="text-sm text-slate-500">From vibrant menu books to high-end product labels,
                                we transform your vision into a professional aesthetic.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-slate-50 rounded-[3rem] p-12 relative overflow-hidden group">
                <div
                    class="absolute top-0 right-0 w-64 h-64 bg-orange-200/20 blur-3xl -mr-32 -mt-32 transition-transform duration-700 group-hover:scale-150">
                </div>
                <h3 class="text-xl font-bold text-slate-900 mb-4 relative z-10">Why choose Color Hut?</h3>
                <p class="text-slate-500 text-sm leading-relaxed mb-6 relative z-10">
                    Unlike generic suppliers, we are a design-first printing studio. Every membership card and label
                    in our collection is vetted for color accuracy and aesthetic appeal. Whether you're looking for
                    vibrant loyalty cards in Bangladesh or complex packaging design, Color Hut is your strategic
                    partner in professional printing.
                </p>
                <div class="flex items-center gap-6 relative z-10">
                    <div>
                        <div class="text-2xl font-black text-slate-900">500+</div>
                        <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Global Clients</div>
                    </div>
                    <div class="w-px h-8 bg-slate-200"></div>
                    <div>
                        <div class="text-2xl font-black text-slate-900">100%</div>
                        <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Custom Design</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-slate-900 text-slate-400 py-12 px-6">
        <div class="max-w-[1600px] mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <img src="/logo.png" alt="Color Hut Studio Branding & Gifts" class="h-10 mb-6 grayscale brightness-200">
                <p class="text-sm italic">Premium graphic design & printing studio in Dhaka, specialized in custom
                    membership cards and professional brand identity solutions.</p>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4 uppercase tracking-widest text-xs">Navigation</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="/" class="hover:text-orange-500 transition-colors">Home</a></li>
                    <li><a href="/all" class="hover:text-orange-500 transition-colors">All Collections</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4 uppercase tracking-widest text-xs">Contact Information</h4>
                <p class="text-sm">Email: contact@colorhutbd.xyz</p>
                <p class="text-sm">Phone: +8801919760626</p>
            </div>
        </div>
        <div
            class="max-w-[1600px] mx-auto border-t border-slate-800 mt-12 pt-8 text-center text-[10px] uppercase tracking-[0.2em]">
            Â© 2026 Color Hut Studio. All Rights Reserved.
        </div>
    </footer>

    <script src="/assets/tracker.js" defer></script>
    <script src="/assets/quote-funnel.js" defer></script>
    <script>
        // Content Protection: Block image/video save & downloader extensions
        document.addEventListener('contextmenu', e => {
            // Check if clicking on or near media
            if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO' || e.target.closest('.product-image-container')) {
                e.preventDefault();
            }
        });

        // Extension Guard: Periodically clear any injected downloader buttons if any
        setInterval(() => {
            const forbidden = ['download', 'save', 'ext-', 'extension'];
            document.querySelectorAll('div, button, span').forEach(el => {
                const classes = el.className.toString().toLowerCase();
                if (forbidden.some(word => classes.includes(word))) {
                    // This is a common pattern for downloader UI injection
                    if (el.style.position === 'absolute' || el.style.position === 'fixed') {
                        el.remove();
                    }
                }
            });
        }, 1000);
    </script>
</body>

</html>